{% extends "base.html" %}

{% block title %}{% if regla %}Editar Regla{% else %}Añadir Regla{% endif %}{% endblock %}

{% block content %}
    <div class="crud-container">
        <h1>{% if regla %}Editar Regla de Comisión{% else %}Añadir Nueva Regla de Comisión{% endif %}</h1>
        <form action="{% if regla %}{{ url_for('main.edit_regla', id=regla['_id']|str_id) }}{% else %}{{ url_for('main.new_regla') }}{% endif %}" method="POST" class="crud-form">
            <div class="form-group">
                <label for="nombre_regla">Nombre de la Regla:</label>
                <input type="text" id="nombre_regla" name="nombre_regla" value="{{ regla['nombre_regla'] if regla else '' }}" required>
            </div>
            <div class="form-group">
                <label for="umbral_ventas_min">Umbral Mínimo de Ventas ($):</label>
                <input type="number" step="0.01" id="umbral_ventas_min" name="umbral_ventas_min" value="{{ regla['umbral_ventas_min'] if regla else '0.00' }}" required>
            </div>
            <div class="form-group">
                <label for="umbral_ventas_max">Umbral Máximo de Ventas ($):</label>
                <input type="number" step="0.01" id="umbral_ventas_max" name="umbral_ventas_max" value="{{ "%.2f"|format(regla['umbral_ventas_max']) if regla and regla['umbral_ventas_max'] != 1.7976931348623157e+308 else '9999999.99' }}" required>
                <small>Usa un valor alto como 9999999.99 para representar "sin límite superior".</small>
            </div>
            <div class="form-group">
                <label for="porcentaje">Porcentaje de Comisión (%):</label>
                <input type="number" step="0.1" id="porcentaje" name="porcentaje" value="{{ regla['porcentaje'] if regla else '0.0' }}" required>
            </div>
            <div class="form-group">
                <label for="fecha_inicio_vigencia">Fecha Inicio Vigencia:</label>
                <input type="date" id="fecha_inicio_vigencia" name="fecha_inicio_vigencia" value="{{ regla['fecha_inicio_vigencia_str'] if regla else '' }}" required>
            </div>
            <div class="form-group">
                <label for="fecha_fin_vigencia">Fecha Fin Vigencia:</label>
                <input type="date" id="fecha_fin_vigencia" name="fecha_fin_vigencia" value="{{ regla['fecha_fin_vigencia_str'] if regla else '' }}" required>
            </div>
            <button type="submit" class="btn btn-primary">{% if regla %}Actualizar{% else %}Guardar{% endif %}</button>
            <a href="{{ url_for('main.list_reglas') }}" class="btn btn-secondary">Cancelar</a>
        </form>
    </div>
{% endblock %}